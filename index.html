<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Cave Au QG</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#020617">

<style>
:root{
 --bg:#020617;
 --card:#0f172a;
 --primary:#22c55e;
 --secondary:#3b82f6;
 --danger:#ef4444;
 --text:#e5e7eb;
 --muted:#94a3b8;
}
*{box-sizing:border-box}
body{
 margin:0;
 font-family:'Segoe UI',Roboto,Arial;
 background:linear-gradient(180deg,#020617,#020617);
 color:var(--text);
}
header{
 background:rgba(2,6,23,.9);
 backdrop-filter:blur(10px);
 padding:16px;
 text-align:center;
 font-size:22px;
 font-weight:700;
 position:sticky;
 top:0;
 z-index:10;
}
.container{padding:16px;animation:fade .35s}
@keyframes fade{
 from{opacity:0;transform:translateY(10px)}
 to{opacity:1;transform:translateY(0)}
}
.card{
 background:var(--card);
 padding:16px;
 border-radius:16px;
 margin-bottom:16px;
 box-shadow:0 10px 25px rgba(0,0,0,.4);
}
.btn{
 width:100%;
 padding:14px;
 margin:8px 0;
 font-size:17px;
 font-weight:600;
 border:none;
 border-radius:14px;
 background:linear-gradient(135deg,var(--secondary),var(--primary));
 color:#fff;
 cursor:pointer;
 transition:.25s;
}
.btn:active{transform:scale(.97)}
.logout{
 width:calc(100% - 32px);
 margin:12px 16px;
 padding:12px;
 border-radius:14px;
 background:var(--danger);
 color:#fff;
 border:none;
 font-weight:600;
}
input,select{
 width:100%;
 padding:12px;
 margin:6px 0;
 border-radius:12px;
 border:none;
 background:#020617;
 color:var(--text);
 outline:none;
}
table{
 width:100%;
 border-collapse:collapse;
 font-size:14px;
}
th{color:var(--muted);padding:10px}
td{
 padding:10px;
 border-bottom:1px solid #1e293b;
 text-align:center;
}
.alert{color:var(--danger);font-weight:700}
.hidden{display:none}
.stat{
 display:flex;
 justify-content:space-between;
 font-size:16px;
 padding:6px 0;
}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="login" class="container">
<header>üîí Cave ¬´ Au QG ¬ª</header>
<div class="card">
<select id="role">
<option value="vendeur">Vendeur</option>
<option value="admin">Admin</option>
</select>
<input id="pin" type="password" placeholder="Code PIN">
<button class="btn" onclick="loginCheck()">Connexion</button>
</div>
</div>

<header id="mainHeader" class="hidden">üçæ Cave ¬´ Au QG ¬ª</header>
<button id="logoutBtn" class="logout hidden" onclick="logout()">üö™ D√©connexion</button>

<!-- HOME -->
<div id="home" class="container hidden">
<button class="btn" onclick="show('stock')">üì¶ Stock</button>
<button class="btn" onclick="show('ventes')">üí∞ Ventes</button>
<button class="btn" onclick="show('recettes')">üìä Recettes</button>
<div class="card">
<div class="stat"><span>Stock total</span><b id="stockTotal">0</b></div>
<div class="stat"><span>Recette du jour</span><b id="recetteJour">0 FCFA</b></div>
</div>
</div>

<!-- STOCK -->
<div id="stock" class="container hidden">
<button class="btn" onclick="show('home')">‚¨Ö Retour</button>
<div class="card">
<input id="s_nom" placeholder="Nom boisson">
<select id="s_cat">
<option>Bi√®re</option><option>Vin</option><option>Whisky</option>
<option>Jus</option><option>Autres</option>
</select>
<input id="s_achat" type="number" placeholder="Prix achat">
<input id="s_vente" type="number" placeholder="Prix vente">
<input id="s_qte" type="number" placeholder="Quantit√©">
<button class="btn" onclick="addBoisson()">Ajouter</button>
</div>
<div class="card">
<table>
<thead>
<tr><th>Nom</th><th>Stock</th><th>Alerte</th><th>‚ùå</th></tr>
</thead>
<tbody id="stockList"></tbody>
</table>
</div>
</div>

<!-- VENTES -->
<div id="ventes" class="container hidden">
<button class="btn" onclick="show('home')">‚¨Ö Retour</button>
<div class="card">
<select id="v_boisson"></select>
<input id="v_qte" type="number" placeholder="Quantit√©">
<button class="btn" onclick="sell()">Valider vente</button>
</div>
<div class="card">
<table>
<thead>
<tr><th>Boisson</th><th>Qt√©</th><th>Total</th><th>Date</th><th>‚ùå</th></tr>
</thead>
<tbody id="venteList"></tbody>
</table>
</div>
</div>

<!-- RECETTES -->
<div id="recettes" class="container hidden">
<button class="btn" onclick="show('home')">‚¨Ö Retour</button>
<div class="card">
<div class="stat"><span>Jour</span><b id="rJour">0 FCFA</b></div>
<div class="stat"><span>Mois</span><b id="rMois">0 FCFA</b></div>
<div class="stat"><span>B√©n√©fice</span><b id="benef">0 FCFA</b></div>
<button class="btn" onclick="window.print()">üìÑ Export PDF</button>
</div>
</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
firebase.initializeApp({
 apiKey:"AIzaSyDOCFzih0gVHQsKtfFyCRgyW4OOrQRJeGo",
 authDomain:"cave-au-qg.firebaseapp.com",
 databaseURL:"https://cave-au-qg-default-rtdb.firebaseio.com",
 projectId:"cave-au-qg",
 storageBucket:"cave-au-qg.appspot.com",
 messagingSenderId:"374133210544",
 appId:"1:374133210544:web:125b5297d68e32a5b62a75"
});
const db=firebase.database();
</script>

<script>
const PIN_ADMIN='9999';
const PIN_VENDEUR='1234';
let roleActuel=null;
let boissons=[],ventes=[];

db.ref("boissons").on("value",s=>{boissons=s.val()||[];refresh();});
db.ref("ventes").on("value",s=>{ventes=s.val()||[];refresh();});

function save(){db.ref().update({boissons,ventes});}

function loginCheck(){
 if((role.value==='admin'&&pin.value===PIN_ADMIN)||(role.value==='vendeur'&&pin.value===PIN_VENDEUR)){
  roleActuel=role.value;
  login.classList.add('hidden');
  mainHeader.classList.remove('hidden');
  logoutBtn.classList.remove('hidden');
  show('home');
  document.querySelector("button[onclick=\"show('stock')\"]").style.display =
   (roleActuel==='vendeur')?'none':'block';
 } else alert('PIN incorrect');
}

function logout(){
 roleActuel=null;
 pin.value='';
 document.querySelectorAll('.container').forEach(c=>c.classList.add('hidden'));
 mainHeader.classList.add('hidden');
 logoutBtn.classList.add('hidden');
 login.classList.remove('hidden');
}

function show(id){
 if(!roleActuel){logout();return;}
 document.querySelectorAll('.container').forEach(c=>c.classList.add('hidden'));
 document.getElementById(id).classList.remove('hidden');
 refresh();
}

function addBoisson(){
 boissons.push({nom:s_nom.value,cat:s_cat.value,achat:+s_achat.value,vente:+s_vente.value,stock:+s_qte.value});
 save();
}

function sell(){
 const i=v_boisson.value,q=+v_qte.value;
 if(boissons[i].stock<q) return alert('Stock insuffisant');
 boissons[i].stock-=q;
 ventes.push({
  nom:boissons[i].nom,
  qte:q,
  total:q*boissons[i].vente,
  benef:(boissons[i].vente-boissons[i].achat)*q,
  date:new Date().toISOString()
 });
 save();
}

function refresh(){
 stockList.innerHTML='';v_boisson.innerHTML='';venteList.innerHTML='';
 let st=0,j=0,m=0,b=0,d=new Date();
 boissons.forEach((x,i)=>{
  st+=x.stock;
  stockList.innerHTML+=`<tr><td>${x.nom}</td><td>${x.stock}</td>
  <td class="${x.stock<=5?'alert':''}">${x.stock<=5?'Faible':''}</td>
  <td onclick="if(roleActuel==='admin'){boissons.splice(${i},1);save()}">‚ùå</td></tr>`;
  v_boisson.innerHTML+=`<option value="${i}">${x.nom}</option>`;
 });
 ventes.forEach((v,i)=>{
  venteList.innerHTML+=`<tr><td>${v.nom}</td><td>${v.qte}</td><td>${v.total}</td>
  <td>${new Date(v.date).toLocaleString()}</td>
  <td onclick="if(roleActuel==='admin'){ventes.splice(${i},1);save()}">‚ùå</td></tr>`;
  const vd=new Date(v.date);
  if(vd.toDateString()==d.toDateString())j+=v.total;
  if(vd.getMonth()==d.getMonth())m+=v.total;
  b+=v.benef;
 });
 stockTotal.innerText=st;
 recetteJour.innerText=j+' FCFA';
 rJour.innerText=j+' FCFA';
 rMois.innerText=m+' FCFA';
 benef.innerText=b+' FCFA';
}
</script>

<script>
if('serviceWorker'in navigator){navigator.serviceWorker.register('sw.js');}
</script>

</body>
</html>